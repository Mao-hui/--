# 部署说明 - 解决刷新404问题

## 问题描述
首页可以正常访问，但其他页面（如 `/official/products`）刷新后报404错误。

## 原因
Vue Router 使用 history 模式，当直接访问或刷新子路由时，服务器会尝试查找对应的文件，但实际上这些路由是前端路由，需要统一重定向到 `index.html`。

## 解决方案

### OpenResty/Nginx 服务器配置

**必须**在服务器配置文件中添加以下配置：

#### 1. 找到 Nginx 配置文件
```bash
# 常见配置文件位置：
/etc/nginx/conf.d/default.conf
/etc/nginx/nginx.conf
/etc/nginx/sites-available/default
```

#### 2. 添加配置
在 `server` 块中添加：

```nginx
location /official/ {
    alias /var/www/html/official/;  # 修改为实际路径
    try_files $uri $uri/ /official/index.html;  # 关键配置
    index index.html;
}
```

#### 3. 完整的 server 配置示例
```nginx
server {
    listen 80;
    server_name 119.45.45.25;
    
    root /var/www/html;  # 修改为实际根目录
    
    location /official/ {
        alias /var/www/html/official/;  # 修改为实际路径
        try_files $uri $uri/ /official/index.html;
        index index.html;
    }
}
```

#### 4. 应用配置
```bash
# 1. 测试配置是否正确
nginx -t

# 2. 如果测试通过，重载配置
nginx -s reload

# 或使用 systemctl
systemctl reload nginx
```

### Apache 服务器配置

如果使用 Apache 服务器，确保 `/official/` 目录下有 `.htaccess` 文件：

```apache
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /official/
  RewriteRule ^index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /official/index.html [L]
</IfModule>
```

## 验证配置

配置完成后，测试以下场景：

1. ✅ 访问首页：`http://119.45.45.25/official/` - 应该正常
2. ✅ 点击导航到产品页：`http://119.45.45.25/official/products` - 应该正常
3. ✅ **刷新产品页**：在 `/official/products` 页面按 F5 刷新 - **应该不再404**
4. ✅ 直接访问：直接在浏览器输入 `http://119.45.45.25/official/products` - 应该正常

## 常见问题

### Q: 配置后仍然404？
A: 检查以下几点：
- 确认配置文件路径正确（`alias` 指向的实际目录）
- 确认 Nginx 配置已重载：`nginx -s reload`
- 检查 Nginx 错误日志：`tail -f /var/log/nginx/error.log`
- 确认文件权限：`chmod -R 755 /var/www/html/official/`

### Q: 如何确认配置已生效？
A: 
```bash
# 查看 Nginx 配置
nginx -T | grep -A 10 "location /official"

# 查看 Nginx 状态
systemctl status nginx

# 测试配置
nginx -t
```

### Q: 无法修改服务器配置怎么办？
A: 如果无法修改服务器配置，可以考虑：
1. 联系服务器管理员协助配置
2. 或者改用 hash 模式路由（不推荐，会影响 SEO 和 URL 美观）

## 重要提示

⚠️ **必须配置服务器路由重定向，否则刷新子页面会一直404！**

这个配置是必需的，无法通过前端代码解决。这是 Vue Router history 模式在服务器端部署的标准要求。

